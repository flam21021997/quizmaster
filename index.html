<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Quiz Master Pegaso</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, Arial, sans-serif;
  background: #f2f2f7;
  padding: 20px;
}
.card {
  background: #fff;
  border-radius: 14px;
  padding: 20px;
}
button {
  width: 100%;
  padding: 14px;
  margin: 6px 0;
  font-size: 16px;
  border: none;
  border-radius: 10px;
  background: #007aff;
  color: white;
}
button.correct { background: #34c759; }
button.wrong { background: #ff3b30; }
button.next {
  background: #5856d6;
  margin-top: 12px;
}
#progress, #stats {
  font-size: 14px;
  color: #555;
  margin-bottom: 6px;
}
</style>
</head>

<body>

<div class="card">
  <div id="progress"></div>
  <div id="stats"></div>
  <h2 id="question"></h2>
  <div id="answers"></div>
  <button id="nextBtn" class="next" style="display:none;">Avanti</button>
</div>

<script src="questions_1.js"></script>
<script src="questions_2.js"></script>
<script src="questions_3.js"></script>

<script>
const questions = [
  ...questions_1,
  ...questions_2,
  ...questions_3
];

// inizializzazione contatori per ogni domanda
questions.forEach(q => {
  if (q._seen === undefined) q._seen = 0;
  if (q._wrong === undefined) q._wrong = 0;
});

let current = null;
let answered = false;
let doneCount = 0;

function shuffle(arr) {
  return arr.sort(() => Math.random() - 0.5);
}

function pickQuestion() {
  const pool = [];
  questions.forEach((q, i) => {
    for (let j = 0; j < q.weight; j++) pool.push(i);
  });
  return pool[Math.floor(Math.random() * pool.length)];
}

function render() {
  answered = false;
  document.getElementById("nextBtn").style.display = "none";

  current = questions[pickQuestion()];
  current._seen++;

  document.getElementById("question").innerText = current.q;
  document.getElementById("progress").innerText =
    `Domanda n° ${doneCount + 1} — Totali fatte: ${doneCount}`;

  document.getElementById("stats").innerText =
    `Errori: ${current._wrong} / ${current._seen}`;

  const box = document.getElementById("answers");
  box.innerHTML = "";

  shuffle([current.correct, ...current.wrong]).forEach(ans => {
    const btn = document.createElement("button");
    btn.innerText = ans;
    btn.onclick = () => checkAnswer(ans, btn);
    box.appendChild(btn);
  });
}

function checkAnswer(answer, btn) {
  if (answered) return;
  answered = true;
  doneCount++;

  document.querySelectorAll("#answers button").forEach(b => b.disabled = true);

  if (answer === current.correct) {
    btn.classList.add("correct");
    current.weight = Math.max(1, current.weight - 1);
  } else {
    btn.classList.add("wrong");
    current._wrong++;
    current.weight += 2;

    document.querySelectorAll("#answers button").forEach(b => {
      if (b.innerText === current.correct) {
        b.classList.add("correct");
      }
    });
  }

  document.getElementById("stats").innerText =
    `Errori: ${current._wrong} / ${current._seen}`;

  document.getElementById("nextBtn").style.display = "block";
}

document.getElementById("nextBtn").onclick = render;

// prima domanda
render();
</script>
</body>
</html>
