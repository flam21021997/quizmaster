<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Quiz Master Pegaso</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, Arial, sans-serif;
  background: #f2f2f7;
  padding: 20px;
}
.card {
  background: #fff;
  border-radius: 14px;
  padding: 20px;
}
button {
  width: 100%;
  padding: 14px;
  margin: 6px 0;
  font-size: 16px;
  border: none;
  border-radius: 10px;
  background: #007aff;
  color: white;
}
button.correct { background: #34c759; }
button.wrong { background: #ff3b30; }
button.secondary { background: #5856d6; }
#topbar {
  display: flex;
  justify-content: space-between;
  font-size: 14px;
  color: #555;
  margin-bottom: 8px;
}
.hidden { display: none; }
</style>
</head>

<body>

<div class="card">
  <div id="topbar">
    <div id="info"></div>
    <div id="timer"></div>
  </div>

  <h2 id="question"></h2>
  <div id="answers"></div>

  <button id="nextBtn" class="secondary hidden">Avanti</button>
  <button id="startExamBtn">üéØ Simulazione Test</button>
  <button id="exitExamBtn" class="secondary hidden">‚¨ÖÔ∏è Torna allo studio</button>
</div>

<script src="questions_1.js"></script>
<script src="questions_2.js"></script>
<script src="questions_3.js"></script>

<script>
const ALL_QUESTIONS = [
  ...questions_1,
  ...questions_2,
  ...questions_3
];

// ====== STATO ======
let mode = "study"; // study | exam
let current = null;
let answered = false;

// studio
let doneCount = 0;

// esame
let examQuestions = [];
let examIndex = 0;
let examScore = 0;
let timeLeft = 0;
let timerId = null;

// ====== UTILS ======
function shuffle(arr) {
  return arr.sort(() => Math.random() - 0.5);
}

// ====== RENDER ======
function renderQuestion(q) {
  document.getElementById("question").innerText = q.q;
  const box = document.getElementById("answers");
  box.innerHTML = "";

  shuffle([q.correct, ...q.wrong]).forEach(ans => {
    const btn = document.createElement("button");
    btn.innerText = ans;
    btn.onclick = () => handleAnswer(ans, btn);
    box.appendChild(btn);
  });
}

// ====== STUDIO ======
function renderStudy() {
  mode = "study";
  answered = false;
  document.getElementById("startExamBtn").classList.remove("hidden");
  document.getElementById("exitExamBtn").classList.add("hidden");
  document.getElementById("nextBtn").classList.add("hidden");
  document.getElementById("timer").innerText = "";

  current = ALL_QUESTIONS[Math.floor(Math.random() * ALL_QUESTIONS.length)];
  document.getElementById("info").innerText =
    `Studio ‚Äî Domande fatte: ${doneCount}`;

  renderQuestion(current);
}

// ====== ESAME ======
function startExam() {
  mode = "exam";
  examScore = 0;
  examIndex = 0;
  timeLeft = 30 * 60; // 30 minuti
  examQuestions = shuffle([...ALL_QUESTIONS]).slice(0, 30);

  document.getElementById("startExamBtn").classList.add("hidden");
  document.getElementById("exitExamBtn").classList.remove("hidden");
  document.getElementById("nextBtn").classList.add("hidden");

  startTimer();
  renderExamQuestion();
}

function startTimer() {
  updateTimer();
  timerId = setInterval(() => {
    timeLeft--;
    updateTimer();
    if (timeLeft <= 0) finishExam();
  }, 1000);
}

function updateTimer() {
  const min = Math.floor(timeLeft / 60);
  const sec = timeLeft % 60;
  document.getElementById("timer").innerText =
    `‚è±Ô∏è ${min}:${sec.toString().padStart(2, "0")}`;
}

function renderExamQuestion() {
  answered = false;
  current = examQuestions[examIndex];
  document.getElementById("info").innerText =
    `Simulazione ‚Äî Domanda ${examIndex + 1} / 30`;

  renderQuestion(current);
}

function finishExam() {
  clearInterval(timerId);
  document.getElementById("answers").innerHTML = "";
  document.getElementById("question").innerText =
    `‚úÖ Test terminato\n\nPunteggio: ${examScore} / 30\nPercentuale: ${Math.round((examScore/30)*100)}%`;

  document.getElementById("info").innerText = "";
  document.getElementById("timer").innerText = "";
  document.getElementById("nextBtn").classList.add("hidden");
}

// ====== RISPOSTA ======
function handleAnswer(answer, btn) {
  if (answered) return;
  answered = true;

  document.querySelectorAll("#answers button").forEach(b => b.disabled = true);

  if (answer === current.correct) {
    btn.classList.add("correct");
    if (mode === "exam") examScore++;
  } else {
    btn.classList.add("wrong");
    document.querySelectorAll("#answers button").forEach(b => {
      if (b.innerText === current.correct) b.classList.add("correct");
    });
  }

  if (mode === "study") {
    doneCount++;
    document.getElementById("nextBtn").classList.remove("hidden");
  } else {
    setTimeout(() => {
      examIndex++;
      if (examIndex >= 30) finishExam();
      else renderExamQuestion();
    }, 800);
  }
}

// ====== BOTTONI ======
document.getElementById("nextBtn").onclick = renderStudy;
document.getElementById("startExamBtn").onclick = startExam;
document.getElementById("exitExamBtn").onclick = () => {
  clearInterval(timerId);
  renderStudy();
};

// avvio
renderStudy();
</script>
</body>
</html>

